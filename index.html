<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>สถานะการตรวจจับวัตถุ</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .status-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background-color: gray;
      transition: background-color 0.5s;
    }
    .label {
      margin-top: 20px;
      font-size: 24px;
      font-weight: bold;
    }
    .sensor-status {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      font-size: 18px;
    }
    .sensor-circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: gray;
      margin-right: 10px;
      transition: background-color 0.5s;
    }
    .timestamp {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 16px;
      color: #333;
    }
    .green { background-color: green; }
    .red { background-color: red; }
    .blue { background-color: blue; }
    .gray { background-color: gray; }
  </style>
</head>
<body>

  <div id="circle" class="status-circle"></div>
  <div id="label" class="label">กำลังโหลด...</div>

  <div class="sensor-status">
    <div id="sensorIndicator" class="sensor-circle"></div>
    <span id="sensorLabel">กำลังโหลด...</span>
  </div>

  <div id="timestamp" class="timestamp"></div>

  <audio id="alertSound" src="alert.mp3"></audio>

  <script>
    const spreadsheetId = '1-XE3bUaqAlEghhtvzgnvrCrIK74zZ8hCfPqVJDJUlj4';
    const apiKey = 'AIzaSyB1pWGTcnbwL78fWgmVuUTi-kZ_qpjZze0';
    const sheetName = 'Sheet1';
    const range = 'B4,C2:C4';
    const url = `https://sheets.googleapis.com/v4/spreadsheets/1-XE3bUaqAlEghhtvzgnvrCrIK74zZ8hCfPqVJDJUlj4/values/Sheet1!B4,C2:C4?key=AIzaSyB1pWGTcnbwL78fWgmVuUTi-kZ_qpjZze0`;

    let previousData = null;

    function fetchData() {
      fetch(url)
        .then(response => response.json())
        .then(data => {
          const values = data.values;
          if (!values || values.length < 2) {
            updateUI(null);
            return;
          }

          const [b4, c2, c3, c4] = [values[0][0], values[1][0], values[2][0], values[3][0]].map(val => val ? val.trim() : '');

          if (isNaN(c2) || isNaN(c3) || isNaN(c4)) {
            updateUI(null, b4);
            return;
          }

          const sensorData = { c2: Number(c2), c3: Number(c3), c4: Number(c4), b4 };
          updateUI(sensorData, b4);

          if (JSON.stringify(sensorData) !== JSON.stringify(previousData)) {
            previousData = sensorData;
            setTimeout(() => location.reload(), 1000);
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          updateUI(null);
        });
    }

    function updateUI(sensorData, b4) {
      const circle = document.getElementById('circle');
      const label = document.getElementById('label');
      const sensorIndicator = document.getElementById('sensorIndicator');
      const sensorLabel = document.getElementById('sensorLabel');
      const timestamp = document.getElementById('timestamp');
      const alertSound = document.getElementById('alertSound');

      if (!b4) {
        sensorIndicator.className = 'sensor-circle gray';
        sensorLabel.textContent = 'เซนเซอร์ออฟไลน์';
        timestamp.textContent = '';
      } else {
        sensorIndicator.className = 'sensor-circle blue';
        sensorLabel.textContent = 'เซนเซอร์ออนไลน์';
        timestamp.textContent = `อัปเดตล่าสุด: ${b4}`;
      }

      if (!sensorData) {
        circle.className = 'status-circle gray';
        label.textContent = 'ไม่พบข้อมูล';
        return;
      }

      const { c2, c3, c4 } = sensorData;

      if (c2 === 12 && c3 > 25 && c4 === 12) {
        circle.className = 'status-circle green';
        label.textContent = 'ไม่พบวัตถุ';
      } else if (c2 < 12 && c3 <= 25 && c4 < 12) {
        circle.className = 'status-circle red';
        label.textContent = 'ตรวจพบวัตถุ!';
        alertSound.play();
      } else {
        circle.className = 'status-circle gray';
        label.textContent = 'ไม่พบข้อมูล';
      }
    }

    setInterval(fetchData, 10000);
    fetchData();
  </script>

</body>
</html>
